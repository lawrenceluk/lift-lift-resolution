# Workout Tracking Data Model v2

## Overview

This data model represents a structured workout program with both planned workouts and actual execution tracking. The fundamental structure is a flat list of weeks, where each week contains workout sessions, exercises, and performance logging.

**Key Design Principle:** Hierarchical IDs encode the navigation path, eliminating the need for explicit parent references. Every ID is deterministic and human-readable.

## Core Principles

1. **Week is the highest-level concept** - The app renders a list of weeks. No nested "program" or "phase" hierarchies.
2. **Phase is metadata** - Phases like "Foundation", "Strength", "Power" are just tags on weeks for filtering/grouping.
3. **Plan and actuals live together** - Each exercise has target parameters and an array of actual set results.
4. **Self-contained weeks** - Everything needed for a training week is in that week's object.
5. **Hierarchical IDs** - IDs follow a strict pattern that encodes parent-child relationships: `week-{N}-session-{N}-exercise-{N}`

---

## ID Format Specification

All IDs follow this deterministic pattern:

```
Week:     week-{weekNumber}
Session:  week-{weekNumber}-session-{sessionNumber}
Exercise: week-{weekNumber}-session-{sessionNumber}-exercise-{exerciseNumber}
```

**Rules:**

- All numbers are 1-indexed (start at 1, not 0)
- Use hyphens as delimiters
- Numbers only (no zero-padding)
- Session and exercise numbers are sequential within their parent

**Examples:**

```
week-1
week-1-session-1
week-1-session-1-exercise-1
week-1-session-1-exercise-2
week-1-session-2-exercise-1
week-3-session-4-exercise-7
```

**Why this matters:**

- IDs are self-documenting (you can read the path)
- Easy to parse parent relationships
- LLM-friendly generation (deterministic rules)
- No need for UUID libraries or duplicate parent reference fields

---

## Data Structures

### Week

The primary organizational unit. A training program is an array of `Week` objects.

```typescript
interface Week {
  id: string; // Format: "week-{weekNumber}"
  weekNumber: number; // Sequential week number (1, 2, 3...)
  phase: string; // Training phase tag: "Foundation", "Strength", "Power", "Deload", "Travel", "Maintenance"
  startDate: string; // ISO 8601 date string (e.g., "2025-10-20")
  endDate: string; // ISO 8601 date string (e.g., "2025-10-26")
  description?: string; // Optional context (e.g., "Volume increase week")
  sessions: WorkoutSession[]; // Array of workout sessions for this week
}
```

**Example:**

```json
{
  "id": "week-1",
  "weekNumber": 1,
  "phase": "Foundation",
  "startDate": "2025-10-20",
  "endDate": "2025-10-26",
  "description": "Easing back in",
  "sessions": []
}
```

---

### WorkoutSession

Represents a single workout day with exercises and optional cardio.

```typescript
interface WorkoutSession {
  id: string; // Format: "week-{weekNumber}-session-{sessionNumber}"
  name: string; // Workout name (e.g., "Lower Heavy", "Upper + Cardio")
  scheduledDate?: string; // ISO 8601 date when workout is scheduled (optional if not yet scheduled)
  dayOfWeek?: string; // Day name: "Sunday", "Monday", etc.
  warmup?: string[]; // Array of warmup instructions
  exercises: Exercise[]; // Array of exercises in this session
  cardio?: CardioBlock; // Optional cardio block
  notes?: string; // Session-level notes

  // Completion tracking
  completed: boolean; // Whether session is finished
  completedDate?: string; // ISO 8601 date when actually completed
  duration?: number; // Actual workout duration in minutes
  rating?: number; // Subjective rating 1-5 (1=terrible, 5=excellent)
}
```

**Example:**

```json
{
  "id": "week-1-session-1",
  "name": "Lower Heavy",
  "scheduledDate": "2025-10-20",
  "dayOfWeek": "Sunday",
  "warmup": ["5-10 min cardio", "1 set of clamshells/monster walks"],
  "exercises": [],
  "completed": false
}
```

---

### Exercise

A specific movement within a workout session, containing both the plan and actual performance data.

```typescript
interface Exercise {
  id: string; // Format: "week-{weekNumber}-session-{sessionNumber}-exercise-{exerciseNumber}"
  name: string; // Exercise name (e.g., "Box Squat", "Bench Press")
  groupLabel?: string; // Pairing/grouping: "A1", "A2", "B1", "B2", "C1", etc.
  // Same letter = paired/superset exercises

  // The plan (prescribed workout)
  warmupSets: number; // Number of warmup sets (can be 0)
  workingSets: number; // Number of working sets to perform
  reps: string; // Target reps: "12", "8-10", "15+", "til it burns"
  targetLoad: string; // Target intensity: "2-3 RIR", "BW" (bodyweight), "60% 1RM"
  restSeconds: number; // Rest period in seconds (60, 90, 120, 180, 210, etc.)
  notes?: string; // Form cues, technique tips, modifications

  // The results (actual performance)
  sets: SetResult[]; // Array of actual sets performed (starts empty)
}
```

**Example:**

```json
{
  "id": "week-1-session-1-exercise-1",
  "name": "Back Squat",
  "groupLabel": "A1",
  "warmupSets": 3,
  "workingSets": 3,
  "reps": "12",
  "targetLoad": "2-3 RIR",
  "restSeconds": 180,
  "notes": "12 reps is a lot! Don't rush.",
  "sets": []
}
```

**Important:**

- `groupLabel` indicates exercise pairing:
  - A1/A2 = paired exercises (do A1, rest, do A2, rest, repeat)
  - Single letter (A1, B1, C1) = straight sets (do all sets before moving on)
- `reps` is a string to handle ranges ("8-10") and non-numeric targets ("til it burns")
- `targetLoad` uses RIR (Reps in Reserve): how many more reps could be done
  - "0 RIR" = failure
  - "1-2 RIR" = could do 1-2 more quality reps
  - "3-4 RIR" = moderate challenge
  - "BW" = bodyweight only

---

### SetResult

Records the actual performance of a single set within an exercise.

```typescript
interface SetResult {
  setNumber: number; // Set number (1, 2, 3, ...)
  reps: number; // Actual reps completed
  weight?: number; // Actual weight used (omit for bodyweight)
  weightUnit: "lbs" | "kg"; // Weight unit
  rir?: number; // Actual RIR felt (0-10+)
  completed: boolean; // Whether set was completed as planned
  notes?: string; // Set-specific notes (e.g., "felt heavy", "form broke down")
}
```

**Note:** Sets do not have IDs. They are accessed by array index within their parent exercise.

**Example:**

```json
{
  "setNumber": 1,
  "reps": 12,
  "weight": 185,
  "weightUnit": "lbs",
  "rir": 3,
  "completed": true
}
```

---

### CardioBlock

Optional cardio component within a workout session.

```typescript
interface CardioBlock {
  type: "zone2" | "intervals" | "sweetspot" | "threshold" | "vo2max"; // Cardio intensity type
  duration: number; // Target duration in minutes
  modality?: string; // Activity type: "stairmaster", "run", "bike", "row"
  instructions?: string; // Specific instructions (e.g., "Conversational pace")

  // Results
  completed: boolean; // Whether cardio was completed
  actualDuration?: number; // Actual duration in minutes
  avgHeartRate?: number; // Average heart rate (bpm)
  notes?: string; // Cardio-specific notes
}
```

**Cardio Types:**

- `zone2`: Low intensity, conversational pace (60-70% max HR)
- `intervals`: High-intensity intervals with rest periods
- `sweetspot`: Moderate-high sustained effort (RPE 6-7)
- `threshold`: Hard sustained effort (RPE 7-8)
- `vo2max`: Maximum effort intervals (RPE 9-10)

---

## Navigation Helpers

Since IDs are hierarchical, you can parse them to navigate the data structure:

```typescript
// Parse any ID to extract hierarchy
const parseId = (id: string) => {
  const parts = id.split("-");
  if (parts[0] !== "week") return null;

  return {
    weekNumber: parseInt(parts[1]),
    weekId: `week-${parts[1]}`,
    sessionNumber: parts.length >= 4 ? parseInt(parts[3]) : null,
    sessionId: parts.length >= 4 ? parts.slice(0, 4).join("-") : null,
    exerciseNumber: parts.length >= 6 ? parseInt(parts[5]) : null,
    exerciseId: parts.length >= 6 ? parts.slice(0, 6).join("-") : null,
  };
};

// Extract parent IDs
const getWeekId = (anyId: string): string => {
  const parts = anyId.split("-");
  return `week-${parts[1]}`;
};

const getSessionId = (exerciseId: string): string => {
  const parts = exerciseId.split("-");
  return parts.slice(0, 4).join("-");
};

// Find entities in data structure
const findWeek = (weeks: Week[], id: string): Week | undefined => {
  const weekId = getWeekId(id);
  return weeks.find((w) => w.id === weekId);
};

const findSession = (weeks: Week[], id: string): WorkoutSession | undefined => {
  const week = findWeek(weeks, id);
  const sessionId = getSessionId(id);
  return week?.sessions.find((s) => s.id === sessionId);
};

const findExercise = (
  weeks: Week[],
  exerciseId: string
): Exercise | undefined => {
  const session = findSession(weeks, exerciseId);
  return session?.exercises.find((ex) => ex.id === exerciseId);
};

// Generate breadcrumb for navigation
const getBreadcrumb = (weeks: Week[], id: string) => {
  const parsed = parseId(id);
  if (!parsed) return null;

  const week = findWeek(weeks, id);
  const session = parsed.sessionId ? findSession(weeks, id) : null;
  const exercise = parsed.exerciseId ? findExercise(weeks, id) : null;

  return {
    week: week ? `Week ${week.weekNumber}` : null,
    session: session?.name || null,
    exercise: exercise?.name || null,
  };
};
```

---

## Common Patterns

### 1. Creating IDs for new entities

```typescript
// Generate week ID
const createWeekId = (weekNumber: number): string => `week-${weekNumber}`;

// Generate session ID
const createSessionId = (weekNumber: number, sessionNumber: number): string =>
  `week-${weekNumber}-session-${sessionNumber}`;

// Generate exercise ID
const createExerciseId = (
  weekNumber: number,
  sessionNumber: number,
  exerciseNumber: number
): string =>
  `week-${weekNumber}-session-${sessionNumber}-exercise-${exerciseNumber}`;
```

### 2. Logging workout results

Start with empty sets array:

```json
{
  "id": "week-1-session-1-exercise-1",
  "name": "Back Squat",
  "workingSets": 3,
  "reps": "12",
  "targetLoad": "2-3 RIR",
  "sets": []
}
```

After workout:

```json
{
  "id": "week-1-session-1-exercise-1",
  "name": "Back Squat",
  "workingSets": 3,
  "reps": "12",
  "targetLoad": "2-3 RIR",
  "sets": [
    {
      "setNumber": 1,
      "reps": 12,
      "weight": 185,
      "weightUnit": "lbs",
      "rir": 3,
      "completed": true
    },
    {
      "setNumber": 2,
      "reps": 12,
      "weight": 185,
      "weightUnit": "lbs",
      "rir": 2,
      "completed": true
    },
    {
      "setNumber": 3,
      "reps": 10,
      "weight": 185,
      "weightUnit": "lbs",
      "rir": 2,
      "completed": true,
      "notes": "Fatigued"
    }
  ]
}
```

### 3. Exercise pairing (supersets)

```json
[
  {
    "id": "week-1-session-1-exercise-1",
    "name": "Bench Press",
    "groupLabel": "A1",
    "workingSets": 3
  },
  {
    "id": "week-1-session-1-exercise-2",
    "name": "Seated Cable Row",
    "groupLabel": "A2",
    "workingSets": 3
  }
]
```

This means: do 1 set of Bench, rest, 1 set of Row, rest, repeat 3 times.

### 4. Calculating metrics

```typescript
// Total volume for a session
const sessionVolume = (session: WorkoutSession): number =>
  session.exercises.reduce(
    (sum, ex) =>
      sum +
      ex.sets.reduce((setSum, set) => setSum + (set.weight || 0) * set.reps, 0),
    0
  );

// Completion percentage
const sessionCompletionRate = (session: WorkoutSession): number => {
  const completedSets = session.exercises.reduce(
    (sum, ex) => sum + ex.sets.filter((s) => s.completed).length,
    0
  );
  const totalSets = session.exercises.reduce(
    (sum, ex) => sum + ex.workingSets,
    0
  );
  return totalSets > 0 ? (completedSets / totalSets) * 100 : 0;
};

// Find PRs (personal records) for an exercise
const findPRs = (weeks: Week[], exerciseName: string) => {
  const allSets = weeks
    .flatMap((w) => w.sessions)
    .flatMap((s) => s.exercises)
    .filter((ex) => ex.name === exerciseName)
    .flatMap((ex) => ex.sets.filter((s) => s.weight !== undefined));

  if (allSets.length === 0) return null;

  const maxWeight = Math.max(...allSets.map((s) => s.weight!));
  const prSet = allSets.find((s) => s.weight === maxWeight);

  return { weight: maxWeight, reps: prSet?.reps };
};
```

---

## File Structure

Workouts are stored as a JSON file containing an array of weeks:

```json
[
  {
    "id": "week-1",
    "weekNumber": 1,
    "phase": "Foundation",
    "startDate": "2025-10-20",
    "endDate": "2025-10-26",
    "sessions": [
      {
        "id": "week-1-session-1",
        "name": "Lower Heavy",
        "exercises": [
          {
            "id": "week-1-session-1-exercise-1",
            "name": "Back Squat",
            "workingSets": 3,
            "reps": "12",
            "targetLoad": "2-3 RIR",
            "restSeconds": 180,
            "sets": []
          }
        ],
        "completed": false
      }
    ]
  }
]
```

---

## Validation Rules

1. **ID Format:**

   - Must follow hierarchical pattern exactly
   - Week IDs: `week-{number}`
   - Session IDs: `week-{number}-session-{number}`
   - Exercise IDs: `week-{number}-session-{number}-exercise-{number}`
   - All numbers are positive integers (1, 2, 3...)

2. **Required fields cannot be null/undefined:**

   - Week: `id`, `weekNumber`, `phase`, `startDate`, `endDate`, `sessions`
   - WorkoutSession: `id`, `name`, `exercises`, `completed`
   - Exercise: `id`, `name`, `warmupSets`, `workingSets`, `reps`, `targetLoad`, `restSeconds`, `sets`
   - SetResult: `setNumber`, `reps`, `weightUnit`, `completed`

3. **Data constraints:**

   - `weekNumber` must be positive integer
   - Dates must be valid ISO 8601 strings
   - `setNumber` should match array index + 1
   - `workingSets` should match target number of sets in `sets` array when workout complete
   - `rating` must be 1-5 if provided
   - `restSeconds` typically: 60, 90, 120, 180, 210, 240

4. **ID consistency:**
   - Exercise IDs must start with their parent session ID
   - Session IDs must start with their parent week ID
   - Week numbers in IDs must match `weekNumber` field

---

## LLM Generation Instructions

When generating workout data programmatically (e.g., via LLM), follow these rules:

**ID Generation:**

```
Week IDs: "week-{weekNumber}"
  Example: "week-1", "week-2", "week-12"

Session IDs: "week-{weekNumber}-session-{sessionNumber}"
  Example: "week-1-session-1", "week-3-session-2"
  Sessions are numbered sequentially within each week (1, 2, 3...)

Exercise IDs: "week-{weekNumber}-session-{sessionNumber}-exercise-{exerciseNumber}"
  Example: "week-1-session-1-exercise-1", "week-2-session-3-exercise-4"
  Exercises are numbered sequentially within each session (1, 2, 3...)
```

**Rules:**

- All numbers are 1-indexed (never use 0)
- Use hyphens as delimiters
- No zero-padding (use "1" not "01")
- IDs must be unique within their scope
- Exercise numbers should be sequential even when groupLabel changes (A1=ex-1, A2=ex-2, B1=ex-3)

---

## TypeScript Type Definitions

```typescript
type PhaseType =
  | "Foundation"
  | "Strength"
  | "Power"
  | "Deload"
  | "Travel"
  | "Maintenance";
type CardioType = "zone2" | "intervals" | "sweetspot" | "threshold" | "vo2max";
type WeightUnit = "lbs" | "kg";

interface Week {
  id: string; // Format: "week-{weekNumber}"
  weekNumber: number;
  phase: PhaseType;
  startDate: string;
  endDate: string;
  description?: string;
  sessions: WorkoutSession[];
}

interface WorkoutSession {
  id: string; // Format: "week-{weekNumber}-session-{sessionNumber}"
  name: string;
  scheduledDate?: string;
  dayOfWeek?: string;
  warmup?: string[];
  exercises: Exercise[];
  cardio?: CardioBlock;
  notes?: string;
  completed: boolean;
  completedDate?: string;
  duration?: number;
  rating?: number;
}

interface Exercise {
  id: string; // Format: "week-{weekNumber}-session-{sessionNumber}-exercise-{exerciseNumber}"
  name: string;
  groupLabel?: string;
  warmupSets: number;
  workingSets: number;
  reps: string;
  targetLoad: string;
  restSeconds: number;
  notes?: string;
  sets: SetResult[];
}

interface SetResult {
  setNumber: number;
  reps: number;
  weight?: number;
  weightUnit: WeightUnit;
  rir?: number;
  completed: boolean;
  notes?: string;
}

interface CardioBlock {
  type: CardioType;
  duration: number;
  modality?: string;
  instructions?: string;
  completed: boolean;
  actualDuration?: number;
  avgHeartRate?: number;
  notes?: string;
}
```

---

## Example Queries

### Get this week's workouts

```typescript
const thisWeek = weeks.find((w) => {
  const now = new Date();
  return new Date(w.startDate) <= now && new Date(w.endDate) >= now;
});
```

### Get incomplete workouts

```typescript
const incompleteWorkouts = weeks
  .flatMap((w) => w.sessions)
  .filter((s) => !s.completed && s.scheduledDate);
```

### Track exercise progression over time

```typescript
const benchHistory = weeks
  .flatMap((w) => w.sessions)
  .flatMap((s) => s.exercises)
  .filter((ex) => ex.name === "Bench Press" && ex.sets.length > 0)
  .map((ex) => ({
    date: findSession(weeks, ex.id)?.completedDate,
    weekNumber: parseId(ex.id)?.weekNumber,
    sets: ex.sets,
  }))
  .filter((entry) => entry.date);
```

### Get all unique exercises in a phase

```typescript
const strengthExercises = weeks
  .filter((w) => w.phase === "Strength")
  .flatMap((w) => w.sessions)
  .flatMap((s) => s.exercises)
  .map((ex) => ex.name);
const uniqueExercises = [...new Set(strengthExercises)];
```

### Navigate from exercise to week

```typescript
const exercise = findExercise(weeks, "week-3-session-2-exercise-5");
const session = findSession(weeks, exercise.id);
const week = findWeek(weeks, exercise.id);
const breadcrumb = `${week.weekNumber} > ${session.name} > ${exercise.name}`;
```

---

## Notes for Implementation

1. **No explicit parent references needed:** The hierarchical ID system means you never need `weekId` or `sessionId` fields. Just parse the ID.

2. **Deterministic for LLMs:** When generating workout plans programmatically, the ID format is simple and unambiguous.

3. **Human-readable:** IDs like `week-3-session-2-exercise-5` are self-documenting in logs and debugging.

4. **Lookup performance:** Finding entities requires parsing IDs and traversing the tree, which is O(n) where n = number of weeks. This is acceptable since n is typically small (< 20 weeks).

5. **Import/export:** The hierarchical structure is preserved in JSON, making it easy to share workout plans.

6. **Flexible scheduling:** Can log workouts retroactively by setting `completedDate` different from `scheduledDate`.

7. **Partial completion:** Can mark session incomplete but still log some sets for recovery/deload scenarios.

8. **Exercise substitutions:** Just update the `name` field; the ID and structure remain unchanged.
